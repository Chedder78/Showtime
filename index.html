<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dual Joystick 3D Asteroids</title>
    <style>
        body { 
            margin: 0;
            overflow: hidden;
            background: #000;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }
        canvas { 
            display: block; 
            width: 100%;
            height: 100%;
        }
        #ui {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 18px;
            text-shadow: 0 0 5px black;
            pointer-events: none;
            z-index: 100;
        }
        .joystick-container {
            position: fixed;
            bottom: 20px;
            width: 100%;
            height: 150px;
            display: flex;
            justify-content: space-between;
            z-index: 100;
        }
        .joystick {
            width: 120px;
            height: 120px;
            position: relative;
        }
        .joystick-base {
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            position: absolute;
        }
        .joystick-thumb {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            touch-action: none;
        }
        .fire-btn {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(255, 50, 50, 0.5);
            border-radius: 50%;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            -webkit-tap-highlight-color: transparent;
        }
        #orientation-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            color: white;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            text-align: center;
            padding: 20px;
            z-index: 200;
        }
        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        #start-btn {
            margin-top: 30px;
            padding: 15px 30px;
            background: #44aaff;
            border: none;
            border-radius: 30px;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        @media (orientation: portrait) {
            #orientation-warning {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div id="ui">SCORE: <span id="score">0</span> | LIVES: <span id="lives">3</span></div>
    
    <div class="joystick-container">
        <!-- Left Joystick (Movement) -->
        <div class="joystick" id="move-joystick">
            <div class="joystick-base"></div>
            <div class="joystick-thumb" id="move-thumb"></div>
            <div class="fire-btn" id="left-fire">FIRE</div>
        </div>
        
        <!-- Right Joystick (Rotation) -->
        <div class="joystick" id="rotate-joystick">
            <div class="joystick-base"></div>
            <div class="joystick-thumb" id="rotate-thumb"></div>
            <div class="fire-btn" id="right-fire">FIRE</div>
        </div>
    </div>
    
    <div id="orientation-warning">
        Please rotate your device to landscape mode for the best experience
    </div>
    <div id="start-screen">
        <h1>DUAL JOYSTICK 3D ASTEROIDS</h1>
        <p>Left stick: Move ship</p>
        <p>Right stick: Rotate view</p>
        <p>Fire buttons: Shoot asteroids</p>
        <button id="start-btn">START GAME</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script>
        // Game setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // Mobile performance optimizations
        renderer.domElement.style.width = '100%';
        renderer.domElement.style.height = '100%';
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x333333);
        scene.add(ambientLight);
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(0, 0, 1);
        scene.add(directionalLight);

        // Space background
        const starsGeometry = new THREE.BufferGeometry();
        const starCount = 2000;
        const positions = new Float32Array(starCount * 3);
        
        for (let i = 0; i < starCount; i++) {
            const i3 = i * 3;
            positions[i3] = (Math.random() - 0.5) * 2000;
            positions[i3 + 1] = (Math.random() - 0.5) * 2000;
            positions[i3 + 2] = (Math.random() - 0.5) * 2000;
        }
        
        starsGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const starsMaterial = new THREE.PointsMaterial({ 
            color: 0xffffff, 
            size: 0.5,
            sizeAttenuation: true
        });
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // Player ship
        const shipGeometry = new THREE.ConeGeometry(0.5, 1.5, 3);
        shipGeometry.rotateX(Math.PI / 2);
        const shipMaterial = new THREE.MeshPhongMaterial({ 
            color: 0x44aaff,
            flatShading: true
        });
        const ship = new THREE.Mesh(shipGeometry, shipMaterial);
        scene.add(ship);

        // Asteroids
        const asteroids = [];
        const asteroidGeometry = new THREE.DodecahedronGeometry(1, 0);
        const asteroidMaterial = new THREE.MeshPhongMaterial({ 
            color: 0x886633,
            flatShading: true
        });

        function createAsteroid() {
            const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
            
            const pos = new THREE.Vector3(
                (Math.random() - 0.5) * 50,
                (Math.random() - 0.5) * 50,
                (Math.random() - 0.5) * 50
            );
            asteroid.position.copy(pos);
            
            const scale = 0.8 + Math.random() * 1.5;
            asteroid.scale.set(scale, scale, scale);
            
            asteroid.rotation.set(
                Math.random() * Math.PI,
                Math.random() * Math.PI,
                Math.random() * Math.PI
            );
            
            asteroid.userData = {
                velocity: new THREE.Vector3(
                    (Math.random() - 0.5) * 0.1,
                    (Math.random() - 0.5) * 0.1,
                    (Math.random() - 0.5) * 0.1
                ),
                rotationSpeed: new THREE.Vector3(
                    (Math.random() - 0.5) * 0.01,
                    (Math.random() - 0.5) * 0.01,
                    (Math.random() - 0.5) * 0.01
                )
            };
            
            scene.add(asteroid);
            asteroids.push(asteroid);
            return asteroid;
        }

        // Bullets
        const bullets = [];
        const bulletGeometry = new THREE.SphereGeometry(0.2, 8, 8);
        const bulletMaterial = new THREE.MeshBasicMaterial({ color: 0xffff00 });

        // Game state
        let score = 0;
        let lives = 3;
        let gameOver = false;
        let gameStarted = false;
        const moveSpeed = 0.15;
        const rotateSpeed = 0.02;
        const bulletSpeed = 0.8;
        let lastShot = 0;
        const shotDelay = 300;

        // Joystick controls
        const moveJoystick = {
            active: false,
            x: 0,
            y: 0,
            element: document.getElementById('move-thumb'),
            base: document.getElementById('move-joystick')
        };

        const rotateJoystick = {
            active: false,
            x: 0,
            y: 0,
            element: document.getElementById('rotate-thumb'),
            base: document.getElementById('rotate-joystick')
        };

        // Initialize joysticks
        function setupJoystick(joystick) {
            const rect = joystick.base.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const maxDist = rect.width / 3;

            function moveThumb(clientX, clientY) {
                const dx = clientX - centerX;
                const dy = clientY - centerY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx);
                
                const limitedDist = Math.min(dist, maxDist);
                const x = limitedDist * Math.cos(angle);
                const y = limitedDist * Math.sin(angle);
                
                joystick.element.style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
                
                // Normalized values (-1 to 1)
                joystick.x = x / maxDist;
                joystick.y = y / maxDist;
            }

            function handleStart(e) {
                e.preventDefault();
                joystick.active = true;
                moveThumb(e.touches[0].clientX, e.touches[0].clientY);
            }

            function handleMove(e) {
                e.preventDefault();
                if (joystick.active) {
                    moveThumb(e.touches[0].clientX, e.touches[0].clientY);
                }
            }

            function handleEnd() {
                joystick.active = false;
                joystick.element.style.transform = 'translate(-50%, -50%)';
                joystick.x = 0;
                joystick.y = 0;
            }

            joystick.base.addEventListener('touchstart', handleStart);
            document.addEventListener('touchmove', handleMove);
            document.addEventListener('touchend', handleEnd);
        }

        setupJoystick(moveJoystick);
        setupJoystick(rotateJoystick);

        // Fire buttons
        document.getElementById('left-fire').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(gameStarted) shoot();
        });
        document.getElementById('right-fire').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(gameStarted) shoot();
        });

        // Start button
        document.getElementById('start-btn').addEventListener('click', startGame);

        // Handle window resize
        function handleResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', handleResize);

        // Game loop
        function gameLoop() {
            if (gameOver || !gameStarted) return;
            
            requestAnimationFrame(gameLoop);
            
            // Ship movement (left joystick)
            ship.position.x += moveJoystick.x * moveSpeed;
            ship.position.y += -moveJoystick.y * moveSpeed;
            
            // Keep ship in bounds
            ship.position.x = Math.max(-20, Math.min(20, ship.position.x));
            ship.position.y = Math.max(-15, Math.min(15, ship.position.y));
            
            // Camera rotation (right joystick)
            camera.position.x = ship.position.x + 10 * Math.sin(rotateJoystick.x * Math.PI);
            camera.position.y = ship.position.y + 10 * rotateJoystick.y;
            camera.position.z = ship.position.z + 10 * Math.cos(rotateJoystick.x * Math.PI);
            camera.lookAt(ship.position);
            
            // Update asteroids
            asteroids.forEach(asteroid => {
                asteroid.position.add(asteroid.userData.velocity);
                asteroid.rotation.x += asteroid.userData.rotationSpeed.x;
                asteroid.rotation.y += asteroid.userData.rotationSpeed.y;
                asteroid.rotation.z += asteroid.userData.rotationSpeed.z;
                
                // Wrap around play area
                ['x', 'y', 'z'].forEach(axis => {
                    if (Math.abs(asteroid.position[axis]) > 50) {
                        asteroid.position[axis] = -asteroid.position[axis] * 0.9;
                    }
                });
            });
            
            // Update bullets
            bullets.forEach((bullet, index) => {
                // Move bullet in direction camera is facing
                const direction = new THREE.Vector3(0, 0, -1);
                direction.applyQuaternion(camera.quaternion);
                direction.multiplyScalar(bulletSpeed);
                bullet.position.add(direction);
                
                bullet.userData.lifetime--;
                
                // Remove old bullets
                if (bullet.userData.lifetime <= 0 || 
                    Math.abs(bullet.position.x) > 50 || 
                    Math.abs(bullet.position.y) > 50 || 
                    Math.abs(bullet.position.z) > 50) {
                    scene.remove(bullet);
                    bullets.splice(index, 1);
                }
                
                // Check collisions
                asteroids.forEach((asteroid, aIndex) => {
                    if (bullet.position.distanceTo(asteroid.position) < asteroid.scale.x + 0.3) {
                        // Hit!
                        score += Math.floor(100 / asteroid.scale.x);
                        document.getElementById('score').textContent = score;
                        
                        // Split asteroid if large enough
                        if (asteroid.scale.x > 1) {
                            for (let i = 0; i < 2; i++) {
                                const newAsteroid = createAsteroid();
                                newAsteroid.position.copy(asteroid.position);
                                newAsteroid.scale.setScalar(asteroid.scale.x * 0.7);
                                newAsteroid.userData.velocity = new THREE.Vector3(
                                    (Math.random() - 0.5) * 0.2,
                                    (Math.random() - 0.5) * 0.2,
                                    (Math.random() - 0.5) * 0.2
                                );
                            }
                        }
                        
                        // Remove bullet and asteroid
                        scene.remove(bullet);
                        bullets.splice(index, 1);
                        scene.remove(asteroid);
                        asteroids.splice(aIndex, 1);
                        
                        // Create new asteroid
                        createAsteroid();
                    }
                });
            });
            
            // Check ship collisions
            asteroids.forEach(asteroid => {
                if (ship.position.distanceTo(asteroid.position) < asteroid.scale.x + 1) {
                    lives--;
                    document.getElementById('lives').textContent = lives;
                    
                    if (lives <= 0) {
                        gameOver = true;
                        document.getElementById('start-screen').style.display = 'flex';
                        document.getElementById('start-screen').innerHTML = `
                            <h1>GAME OVER</h1>
                            <p>Final Score: ${score}</p>
                            <button id="restart-btn">PLAY AGAIN</button>
                        `;
                        document.getElementById('restart-btn').addEventListener('click', restartGame);
                    } else {
                        // Reset position after hit
                        ship.position.set(0, 0, 0);
                    }
                }
            });
            
            renderer.render(scene, camera);
        }

        function shoot() {
            if (Date.now() - lastShot < shotDelay) return;
            
            const bullet = new THREE.Mesh(bulletGeometry, bulletMaterial);
            bullet.position.copy(ship.position);
            
            bullet.userData = {
                lifetime: 100
            };
            
            scene.add(bullet);
            bullets.push(bullet);
            lastShot = Date.now();
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            gameStarted = true;
            gameOver = false;
            score = 0;
            lives = 3;
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            
            // Clear existing asteroids
            asteroids.forEach(asteroid => scene.remove(asteroid));
            asteroids.length = 0;
            
            // Clear bullets
            bullets.forEach(bullet => scene.remove(bullet));
            bullets.length = 0;
            
            // Create new asteroids
            for (let i = 0; i < 6; i++) {
                createAsteroid();
            }
            
            // Reset ship position
            ship.position.set(0, 0, 0);
            
            // Reset camera
            camera.position.set(0, 0, 10);
            camera.lookAt(0, 0, 0);
            
            // Start game loop
            gameLoop();
        }

        function restartGame() {
            startGame();
        }

        // Initial asteroid creation
        for (let i = 0; i < 6; i++) {
            createAsteroid();
        }
    </script>
</body>
</html>
